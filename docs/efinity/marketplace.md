
# Marketplace

---------
## Calls

---------
### cancel_listing
Cancels the listing with `listing_id`. Only callable by the seller.

\# Parameters

- `listing_id`: The ID of the listing to cancel

\# Errors

- [`Error::ListingNotFound`] if the listing under `listing_id` does not exist
- [`Error::NoPermission`] if the listing seller is not the caller, `origin`
#### Attributes
| Name | Type |
| -------- | -------- | 
| listing_id | `ListingIdOf<T>` | 

#### Python
```python
call = substrate.compose_call(
    'Marketplace', 'cancel_listing', {'listing_id': '[u8; 32]'}
)
```

---------
### create_listing
Places a sell order. Requires `make_asset_id` or `take_asset_id` to be a currency.
The id for the listing is generated by hashing the encoded bytes of the listing.

\# Parameters

- `make_asset_id`: The id of the asset being sold
- `take_asset_id`: The id of the asset being requested
- `amount`: The number of units being sold
- `price`: The requested price for each unit. If it&\#x27;s an auction, this is the minimum
  bid
- `salt`: Can be used to differentiate listings
- `auction_data`: Including this makes the listing an auction

\# Errors

- [`Error::InvalidAuctionStart`] if the start is less than the current block +
  `T::ListingActiveDelay`
- [`Error::NoCurrency`] Neither the make or take side is considered a currency
- [`Error::ListingForbidden`] if make or take side tokens are not allowed to be listed
- [`Error::CurrencyNotAllowedAsRoyalty`] if currency cannot be used as a royalty
- [`Error::LowBaseCurrencyBalance`] if base currency balance is too low
- [`Error::LowTokenBalance`] token balance is too low for reserve
- [`Error::ListingAlreadyExists`] if a listing with the same ID already exists
#### Attributes
| Name | Type |
| -------- | -------- | 
| make_asset_id | `AssetIdOf<T>` | 
| take_asset_id | `AssetIdOf<T>` | 
| amount | `TokenBalanceOf<T>` | 
| price | `TokenBalanceOf<T>` | 
| salt | `Salt<T>` | 
| auction_data | `Option<AuctionDataOf<T>>` | 

#### Python
```python
call = substrate.compose_call(
    'Marketplace', 'create_listing', {
    'amount': 'u128',
    'auction_data': (
        None,
        {
            'end_block': 'u32',
            'start_block': 'u32',
        },
    ),
    'make_asset_id': {
        'collection_id': 'u128',
        'token_id': 'u128',
    },
    'price': 'u128',
    'salt': 'Bytes',
    'take_asset_id': {
        'collection_id': 'u128',
        'token_id': 'u128',
    },
}
)
```

---------
### fill_listing
Fills a fixed price listing. This will execute immediately.
\# Parameters

- `listing_id`: The id for the listing to buy from
- `amount`: The number of units purchased

\# Errors

- [`Error::ListingNotFound`] if the listing under `listing_id` does not exist
- [`Error::BuyerIsSeller`] if the buyer is the seller of the listing
- [`Error::ListingIsWrongType`] if the listing is not under auction
- [`Error::InvalidAmount`] if the amount that still needs to be filled is greater than
  `amount`
- [`Error::ListingNotActive`] if the listing has not passed the `ListingActiveDelay` yet
- [`Error::TakeValueUnderMinimum`] if the listings `take` value is under the minimum
  required
- [`Error::LowTokenBalance`] if the buyer does not have enough tokens for reserve
#### Attributes
| Name | Type |
| -------- | -------- | 
| listing_id | `ListingIdOf<T>` | 
| amount | `TokenBalanceOf<T>` | 

#### Python
```python
call = substrate.compose_call(
    'Marketplace', 'fill_listing', {
    'amount': 'u128',
    'listing_id': '[u8; 32]',
}
)
```

---------
### finalize_auction
Finalize the auction with id: `listing_id`. This will end the auction and transfer
funds. It fails if the auction is not over.

\# Parameters

- `listing_id`: The ID for the listing to finalize

\# Errors

- [`Error::ListingNotFound`] if listing under `listing_id` does not exist
- [`Error::ListingIsWrongType`] if listing is not an auction
- [`Error::AuctionNotOver`] if the auction has not finished yet
- [`Error::TakeValueUnderMinimum`] if the take value is less than the minimum required
#### Attributes
| Name | Type |
| -------- | -------- | 
| listing_id | `ListingIdOf<T>` | 

#### Python
```python
call = substrate.compose_call(
    'Marketplace', 'finalize_auction', {'listing_id': '[u8; 32]'}
)
```

---------
### place_bid
Places a bid on a listing. The listing must be an auction, and it must be currently
active.

\# Parameters

- `listing_id`: The id for the listing to buy from
- `price`: The price for a single unit

\# Errors

- [`Error::ListingNotFound`] if listing under `listing_id` does not exist
- [`Error::BuyerIsSeller`] if the bidder is the seller of the listing
- [`Error::InactiveAuction`] if listing operates outside of specified start and end
  block
- [`Error::InvalidPrice`] if price is less than mininum_price for a bid
#### Attributes
| Name | Type |
| -------- | -------- | 
| listing_id | `ListingIdOf<T>` | 
| price | `TokenBalanceOf<T>` | 

#### Python
```python
call = substrate.compose_call(
    'Marketplace', 'place_bid', {
    'listing_id': '[u8; 32]',
    'price': 'u128',
}
)
```

---------
### set_protocol_fee
Change the protocol fee to `protocol_fee`. Fails if `origin` is invalid.

\#Parameters

- `protocol_fee`: Percentage of fee to set
#### Attributes
| Name | Type |
| -------- | -------- | 
| protocol_fee | `Perbill` | 

#### Python
```python
call = substrate.compose_call(
    'Marketplace', 'set_protocol_fee', {'protocol_fee': 'u32'}
)
```

---------
## Events

---------
### AuctionFinalized
An auction was finalized
#### Attributes
| Name | Type | Composition
| -------- | -------- | -------- |
| listing_id | `ListingIdOf<T>` | ```[u8; 32]```
| winning_bid | `Option<BidOf<T>>` | ```(None, {'bidder': 'AccountId', 'price': 'u128'})```
| protocol_fee | `TokenBalanceOf<T>` | ```u128```
| royalty | `TokenBalanceOf<T>` | ```u128```

---------
### BidPlaced
A bid was placed
#### Attributes
| Name | Type | Composition
| -------- | -------- | -------- |
| listing_id | `ListingIdOf<T>` | ```[u8; 32]```
| bid | `BidOf<T>` | ```{'bidder': 'AccountId', 'price': 'u128'}```

---------
### ListingCancelled
A listing was cancelled
#### Attributes
| Name | Type | Composition
| -------- | -------- | -------- |
| listing_id | `ListingIdOf<T>` | ```[u8; 32]```

---------
### ListingCreated
A listing was created
#### Attributes
| Name | Type | Composition
| -------- | -------- | -------- |
| listing_id | `ListingIdOf<T>` | ```[u8; 32]```
| listing | `ListingOf<T>` | ```{'seller': 'AccountId', 'make_asset_id': {'collection_id': 'u128', 'token_id': 'u128'}, 'take_asset_id': {'collection_id': 'u128', 'token_id': 'u128'}, 'amount': 'u128', 'price': 'u128', 'min_take_value': 'u128', 'fee_side': ('NoFee', 'Make', 'Take'), 'creation_block': 'u32', 'deposit': 'u128', 'salt': 'Bytes', 'data': {'FixedPrice': None, 'Auction': {'start_block': 'u32', 'end_block': 'u32'}}, 'state': {'FixedPrice': {'amount_filled': 'u128'}, 'Auction': {'high_bid': (None, {'bidder': 'AccountId', 'price': 'u128'})}}}```

---------
### ListingFilled
A listing was filled or partially filled
#### Attributes
| Name | Type | Composition
| -------- | -------- | -------- |
| listing_id | `ListingIdOf<T>` | ```[u8; 32]```
| buyer | `T::AccountId` | ```AccountId```
| amount_filled | `TokenBalanceOf<T>` | ```u128```
| amount_remaining | `TokenBalanceOf<T>` | ```u128```
| protocol_fee | `TokenBalanceOf<T>` | ```u128```
| royalty | `TokenBalanceOf<T>` | ```u128```

---------
### ProtocolFeeSet
Protocol fee was set
#### Attributes
| Name | Type | Composition
| -------- | -------- | -------- |
| protocol_fee | `Perbill` | ```u32```

---------
## Storage functions

---------
### Info
 Stores information about the marketplace

#### Python
```python
result = substrate.query(
    'Marketplace', 'Info', []
)
```

#### Return value
```python
{
    'auction_listing_count': 'u32',
    'fixed_price_listing_count': 'u32',
    'protocol_fee': 'u32',
}
```
---------
### ListingIdsByAccountId
 Listing Ids by [`AccountId`](frame_system::Config::AccountId)

#### Python
```python
result = substrate.query(
    'Marketplace', 'ListingIdsByAccountId', ['AccountId', '[u8; 32]']
)
```

#### Return value
```python
()
```
---------
### ListingIdsByMakeAsset
 Listing Ids by make asset&#x27;s collection id and token id

#### Python
```python
result = substrate.query(
    'Marketplace', 'ListingIdsByMakeAsset', ['u128', 'u128']
)
```

#### Return value
```python
'[u8; 32]'
```
---------
### ListingIdsByTakeAsset
 Listing Ids by take asset&#x27;s collection id and token id

#### Python
```python
result = substrate.query(
    'Marketplace', 'ListingIdsByTakeAsset', ['u128', 'u128']
)
```

#### Return value
```python
'[u8; 32]'
```
---------
### Listings
 Listings by ID

#### Python
```python
result = substrate.query(
    'Marketplace', 'Listings', ['[u8; 32]']
)
```

#### Return value
```python
{
    'amount': 'u128',
    'creation_block': 'u32',
    'data': {'Auction': {'end_block': 'u32', 'start_block': 'u32'}, 'FixedPrice': None},
    'deposit': 'u128',
    'fee_side': ('NoFee', 'Make', 'Take'),
    'make_asset_id': {'collection_id': 'u128', 'token_id': 'u128'},
    'min_take_value': 'u128',
    'price': 'u128',
    'salt': 'Bytes',
    'seller': 'AccountId',
    'state': {
        'Auction': {
            'high_bid': (None, {'bidder': 'AccountId', 'price': 'u128'}),
        },
        'FixedPrice': {'amount_filled': 'u128'},
    },
    'take_asset_id': {'collection_id': 'u128', 'token_id': 'u128'},
}
```
---------
## Constants

---------
### ListingActiveDelay
 The delay before a listing is considered active
#### Value
```python
5
```
#### Python
```python
constant = substrate.get_constant('Marketplace', 'ListingActiveDelay')
```
---------
### ListingDeposit
 The deposit for creating a listing
#### Value
```python
2025700000000000000
```
#### Python
```python
constant = substrate.get_constant('Marketplace', 'ListingDeposit')
```
---------
### MaxRoundingError
 The max amount that can be lost due to rounding before failing
#### Value
```python
1000
```
#### Python
```python
constant = substrate.get_constant('Marketplace', 'MaxRoundingError')
```
---------
### MaxSaltLength
 Max length of salt used when creating listings and bids
#### Value
```python
32
```
#### Python
```python
constant = substrate.get_constant('Marketplace', 'MaxSaltLength')
```
---------
### MinimumBidIncreasePercentage
 The percentage the minimum bid in an auction must increase by
#### Value
```python
50000000
```
#### Python
```python
constant = substrate.get_constant('Marketplace', 'MinimumBidIncreasePercentage')
```
---------
### ReserveIdentifier
 ID used by the pallet for making reservations
#### Value
```python
'0x6d61726b74706c63'
```
#### Python
```python
constant = substrate.get_constant('Marketplace', 'ReserveIdentifier')
```
---------
## Errors

---------
### AuctionNotOver
Cannot finalize an auction that is not over

---------
### BuyerIsSeller
The seller is not allowed to buy their own listing

---------
### CurrencyNotAllowedAsRoyalty
The currency is not allowed to be used as a royalty payment

---------
### InactiveAuction
Cannot bid on an auction that has not started or is over

---------
### InvalidAmount
The amount is invalid

---------
### InvalidAuctionEnd
The end time of the auction must be after the start

---------
### InvalidAuctionStart
The start time of the auction must be greater than the current block plus the
minimum requirement

---------
### InvalidPrice
The price is invalid

---------
### ListingAlreadyExists
A listing with this id already exists

---------
### ListingForbidden
Listing is forbidden for this token

---------
### ListingIsWrongType
An action was taken that is not compatible with the listing&\#x27;s type.

---------
### ListingNotActive
The listing has not crossed the mandatory delay before its considered active

---------
### ListingNotFound
The listing does not exist

---------
### LowBaseCurrencyBalance
The base currency balance is too low

---------
### LowTokenBalance
The token balance is too low

---------
### MaxRoundingErrorExceeded
The max rounding error was exceeded

---------
### NoCurrency
Neither the make side or the take side of the listing is considered a currency

---------
### NoPermission
The caller does not have permission for this operation

---------
### TakeValueUnderMinimum
The take value is under the minimum requirement

---------
### TransferParamCreationFailed
Transfer params could not be created

---------
### UnableToFill
the order cannot be filled

---------